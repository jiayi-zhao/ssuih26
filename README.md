# Steps to Run the Program

## Make sure you have node installed

If you're using mac, you can run
```
brew install node
```
And after you download node, you can run command ```npm``` and make sure the version is at least npm@6.0.0.

Then, ```cd``` into phase5_react and run ```npm install```.

After everything is installed, you can open up another terminal and ```cd``` into phase5_api folder and run ```rails s -p 3001```. It is important to run the api on port 3001.

Then, in your other terminal window, while the server api is running, ```cd``` into phase5_react and do the command ```npm start```.

## Some explanation of the interface

In this project I mainly worked on the parent view interaction and thus it probably doesn't fully fulfill the requirement and I don't really mind if I get hugh points off. But it was really fun working with API and re-think about interactions. It would be nice if you can log into any parent with children and registrations and go to the dashboard page.

### To make your life easier

For the guest, the only things they can do is view the camps and see the basic information. However, they need to register an account to acccess dahboard & pay. (I didn't have time to finish the creating account so I left the code off)

For the parent, they can go to their dash board and have a preview of their students and upcoming camps and the interfaces are really easy to use. In the camps, they can also view other students and save registrations in a shopping cart and pay for it later.

For instructors, just basic view of what the guest can see. For admins, admins can see tables of all information.

### API part

I implemented ability but found out that because of serializer, and the behavior of it, the ability file cannot stop certain actions. Thus, my ability file might not be 100% coverage but it might be. However, you can use curl to test the accessibility without the need to  send requests from real pages.

I'm using JWT as a encoding schema for encoding user tokens and use that for verifying. For any user, their token is generated by such and you can get the same result by doing the following:

Suppose you want to generate a token for user with id 10.
```
payload = {user_id: 10}
secret = 'jiayi'
token = JWT.encode(payload, secret)
```
Then you can run a curl command like
```
curl -H "Authorization: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxfQ.wR0yeMva8iYHQ8vd9RqRIoq612KvdYP-7hSbrPxquTE" http://localhost:3001/users
```
to get all users with token of user @mark.

Then you can test with different tokens of different roles and see what is allowed and what is not allowed. If an action is not permitted, the result will gives us an error message.

The following are some explanation mainly for the API limitaitons and performance for parent users.

# Routes Accesses and Users Abilities

The following table describes the routes the users of each type can access and the abilities they have

Request                    | Guest | Parent | Instructor | Admin 
---------------------------| -- | -- | -- | -- 
`GET /users`               | no | yes, itself | no | yes 
`GET /users/:id`           | no | yes, itself | yes, itself | yes 
`POST /users`	         | no | no | no | yes 
`PUT /users/:id`	         | no | yes, itself | yes, itself | yes 
`DELETE /users/:id`        | no | no | no	| yes 
 | | | | | 
`GET /camps`	         | yes<br>only upcoming camps | yes<br>only active camps | yes<br>only active camps | yes
`GET /camps/:id`	         | yes<br>only upcoming camps | yes<br>only active camps | yes<br>only active camps | yes
`POST /camps`	         | no | no | no | yes
`PUT /camps/:id`	         | no | no | no | yes
`DELETE /camps/:id`	| no | no | no | yes
 | | | | | 
`GET /curriculums`         | yes<br>only active curriculums | yes<br>only active curriculums | yes<br>only active curriculums | yes
`GET /curriculums/:id`	| yes<br>only active curriculums | yes<br>only active curriculums | yes<br>only active curriculums | yes
`POST /curriculums`	| no | no | no | yes
`PUT /curriculums/:id`	| no | no | no | yes
`DELETE /curriculums/:id`	| no | no | no | no
 | | | | | 
`GET /locations`           | yes<br>only active locations | yes<br>only active locations | yes<br>only active locations | yes
`GET /locations/:id`       | yes<br>only active locations | yes<br>only active locations | yes<br>only active locations | yes
`POST /locations`          | no | no | no | yes
`PUT /locations/:id`       | no | no | no | yes
`DELETE /locations/:id`    | no | no | no | yes
 | | | | | 
`GET /instructors`         | yes<br>only active instructors | yes<br>only active instructors | yes<br>only active instructors | yes
`GET /instructors/:id`     | yes<br>only active instructors | yes<br>only active instructors | yes<br>only active instructors | yes
`POST /instructors`        | no | no | no | yes
`PUT /instructors/:id`     | no | no | yes, itself | yes
`DELETE /instructors/:id`   | no | no | no | yes
 | | | | | 
`GET /registrations`       | no | yes<br>only those belong to itself | no | yes
`GET /registrations/:id`   | no | yes<br>only those belong to itself | no | yes
`POST /registrations`      | no | yes<br>for students belong to itself | no | yes
`PUT /registrations/:id`   | no | yes<br>when payment is not made | no | yes
`DELETE /registrations/:id` | no | yes<br>when payment is not made | no | yes
 | | | | | 
`GET /students`            | no | yes<br>only those belong to itself | yes<br>only those who are its students | yes
`GET /students/:id`        | no | yes<br>only those belong to itself | yes<br>only those who are its students | yes
`POST /students`           | no | yes<br>only those belong to itself | no | yes
`PUT /students/:id`        | no | yes<br>only those belong to itself | no | yes
`DELETE /students/:id`     | no | no | no | yes
 | | | | | 
`GET /families`            | no | no | yes<br>only those who are its students | yes
`GET /families/:id`        | no | yes, itself | yes<br>only those who are its students | yes
`POST /families`           | no | no | no | yes
`PUT /families/:id`        | no | yes, itself | no | yes
`DELETE /families/:id`     | no | no | no | no

# Detailed Functionality and Testing

## Parent

In the following examples, we will use user 9 of type parent to illustrate the example result.

The authorization is a JSON hashed code generated within the server where the browerse 
get such information and send the request with the header's authorization token every time.
The user 9 authorization token is generated by a user 9 of type parent
```
JWT.encode({user_id: 9, 'jiayi')
```

### GET /users/:id

Parents can read his or her own user information, and a sample output can be

```
{
"id":9,
"username":"Ward643",
"role":"parent",
"email":"ward643@example.com",
"phone":"9784675905",
"active":true,
"family":{
         "id":1,
         "family_name":"Ward",
         "parent_first_name":"Rosella",
         "user_id":9,
         "active":true},
"students":[
           {
           "id":27,
           "proper_name":"Angeline Ward",
           "family_id":1,
           "date_of_birth":"2007-05-01",
           "rating":326,
           "active":true
           }],
"past_camps":[],
"upcoming_camps":[
                 {
                 "id":8,
                 "curriculum":{
                              "id":1,
                              "name":"Principles of Chess",
                              "description":"This camp is designed for beginning students who know need to learn 
                                             opening principles, pattern recognition and basic tactics and mates.  
                                             Students will be given a set of mate-in-one flashcards and are expected 
                                             to work on these at home during the week.",
                              "min_rating":0,
                              "max_rating":500,
                              "active":true
                              },
                  "location":{
                             "id":1,
                             "name":"North Side",
                             "street_1":"801 Union Place",
                             "street_2":null,
                             "city":"Pittsburgh",
                             "state":"PA",
                             "zip":"15212",
                             "max_capacity":16,
                             "active":true
                             },
                   "instructors":[
                                 {
                                 "id":8,
                                 "name":"Reyes-Franco, Sarah",
                                 "bio":"Great TA for 67-272; hopefully can teach chess too.",
                                 "email":"sarah@razingrooks.org",
                                 "phone":"4122683259",
                                 "active":true
                                 }],
                   "cost":150.0,
                   "start_date":"2018-06-18",
                   "end_date":"2018-06-22",
                   "time_slot":"pm",
                   "max_students":8,
                   "is_open":false,
                   "open_spots":0,
                   "active":true,
                   "registered_students_list":[
                                              {"proper_name":"Shakira Koepp"},
                                              {"proper_name":"Ericka Mayer"},
                                              {"proper_name":"Jaycee Walter"},
                                              {"proper_name":"Asia McDermott"},
                                              {"proper_name":"Angeline Ward"},
                                              {"proper_name":"Niko Bailey"},
                                              {"proper_name":"Adell Weissnat"},
                                              {"proper_name":"Neva Walter"}],
                   "own_registered_students_list":[
                                                  {
                                                  "proper_name":"Angeline Ward",
                                                  "date_of_birth":"2007-05-01",
                                                  "rating":326,
                                                  "active":true,
                                                  "paid":true}
                                                  ]}
}
```
The output can be generated by sending the following requests by curl
```
curl -H "Authorization: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo5fQ.aA3dJ7sMtirNFjK9rucW09MDq6U8Mkmsl6FNDY4DzRI" http://localhost:3001/users/9
```
It is however impossible to do the following requests and the api will return {}
```
GET /users
curl -H "Authorization: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo5fQ.aA3dJ7sMtirNFjK9rucW09MDq6U8Mkmsl6FNDY4DzRI" http://localhost:3001/users
GET /users/8
curl -H "Authorization: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo5fQ.aA3dJ7sMtirNFjK9rucW09MDq6U8Mkmsl6FNDY4DzRI" http://localhost:3001/users/8
```

### GET /camps & GET /camps/:id

Parents can read information of active camps and a sample output can be

```
{
"id":12,
"curriculum":{
             "id":1,
             "name":"Principles of Chess",
             "description":"This camp is designed for beginning students who know need to 
                            learn opening principles, pattern recognition and basic tactics 
                            and mates.  Students will be given a set of mate-in-one flashcards 
                            and are expected to work on these at home during the week.",
             "min_rating":0,
             "max_rating":500,
             "active":true
             },
"location":{
           "id":2,
           "name":"Carnegie Mellon",
           "street_1":"5000 Forbes Avenue",
           "street_2":"Porter Hall 222",
           "city":"Pittsburgh",
           "state":"PA",
           "zip":"15213",
           "max_capacity":16,
           "active":true
           },
"instructors":[
              {
              "id":4,
              "name":"Kern, Becca",
              "bio":"Great TA for 67-272; hopefully can teach chess too.",
              "email":"becca@razingrooks.org",
              "phone":"4122683259",
              "active":true
              },{
              "id":6,
              "name":"Huang, Rick",
              "bio":"Great TA for 67-272; hopefully can teach chess too.",
              "email":"rick@razingrooks.org",
              "phone":"4122683259",
              "active":true
              }],
"cost":150.0,
"start_date":"2018-06-25",
"end_date":"2018-06-29",
"time_slot":"pm",
"max_students":8,
"is_open":true,
"open_spots":1,
"active":true,
"registered_students_list":[
                           {"proper_name":"Ethel Ward"},
                           {"proper_name":"Horacio Kuvalis"},
                           {"proper_name":"Yessenia Wilkinson"},
                           {"proper_name":"Brain Cormier"},
                           {"proper_name":"Grace Connelly"},
                           {"proper_name":"Onie Rohan"},
                           {"proper_name":"Alaina Schulist"}
                           ],
"own_registered_students_list":[
                               {
                               "proper_name":"Ethel Ward",
                               "date_of_birth":"2007-05-01",
                               "rating":276,
                               "active":true,
                               "paid":true
                               }]
}
```
There are no inactive camps in the database and if there is, the index action would not
show the inactive camps and the following request should return {}
```
GET /camps/:inactive_camp_id
curl -H "Authorization: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo5fQ.aA3dJ7sMtirNFjK9rucW09MDq6U8Mkmsl6FNDY4DzRI" http://localhost:3001/camps/inactive_camp_id
```
### GET /curriculums & GET /curriculums/:id

```
{
"id":4,
"name":"Nimzo-Indian Defense",
"description":"This camp is for intermediate and advanced players who are looking for 
               a good defense to play against 1. d4.  Many world champions, including 
               Mikhail Tal and Garry Kasparov, have played this defense with great 
               success.  
               Students will have 4 to 6 games to review each day at home as homework.",
"min_rating":1000,
"max_rating":3000,
"active":true,
"past_camps":[],
"upcoming_camps":[
                 {
                 "id":5,
                 "location_name":"Squirrel Hill",
                 "cost":150.0,
                 "start_date":"2018-06-11",
                 "end_date":"2018-06-15",
                 "time_slot":"pm",
                 "active":true
                 },{
                 "id":19,
                 "location_name":"Squirrel Hill",
                 "cost":150.0,
                 "start_date":"2018-07-16",
                 "end_date":"2018-07-20",
                 "time_slot":"am",
                 "active":true
                 }]
}
```
curriculum 3 is inactive

### GET /locations & GET /locations/:id

```
{
"id":1,
"name":"North Side",
"street_1":"801 Union Place",
"street_2":null,
"city":"Pittsburgh",
"state":"PA",
"zip":"15212",
"max_capacity":16,
"active":true,
"past_camps":[],
"upcoming_camps":[
                 {
                 "id":4,
                 "curriculum_name":"Endgame Principles",
                 "cost":150.0,
                 "start_date":"2018-06-11",
                 "end_date":"2018-06-15",
                 "time_slot":"pm",
                 "active":true
                 },{
                 "id":6,
                 "curriculum_name":"Principles of Chess",
                 "cost":150.0,
                 "start_date":"2018-06-18",
                 "end_date":"2018-06-22",
                 "time_slot":"am",
                 "active":true}]
}
```
no inactive locations

### GET /instructors & GET /instructors/:id

```
{
"id":1,
"name":"Heimann, Mark",
"bio":"Mark is currently among the top 150 players in the United States (USCF rating: 2468) and has won 4 national scholastic chess championships.  Mark is currently working on his Ph.D. in computer science at the University of Michigan and plays for the school's chess team.",
"email":"mark@razingrooks.org",
"phone":"4122688211",
"past_camps":[],
"upcoming_camps":[
                 {
                 "id":2,
                 "curriculum_name":"Mastering Chess Tactics",
                 "location_name":"Squirrel Hill",
                 "cost":150.0,
                 "start_date":"2018-06-11",
                 "end_date":"2018-06-15",
                 "time_slot":"am",
                 "active":true
                 },{
                 "id":3,
                 "curriculum_name":"Principles of Chess",
                 "location_name":"ACAC",
                 "cost":150.0,
                 "start_date":"2018-06-11",
                 "end_date":"2018-06-15",
                 "time_slot":"pm",
                 "active":true}],
"active":true
}
```
instructor 3 is inactive

### GET /registrations & GET /registrations/:id

```
{
"id":27,
"camp":{
       "id":8,
       "curriculum":{
                    "id":1,
                    "name":"Principles of Chess",
                    "description":"This camp is designed for beginning students who 
                                   know need to learn opening principles, pattern 
                                   recognition and basic tactics and mates.  
                                   Students will be given a set of mate-in-one 
                                   flashcards and are expected to work on these at 
                                   home during the week.",
                    "min_rating":0,
                    "max_rating":500,
                    "active":true
                    },
        "location":{
                   "id":1,
                   "name":"North Side",
                   "street_1":"801 Union Place",
                   "street_2":null,
                   "city":"Pittsburgh",
                   "state":"PA",
                   "zip":"15212",
                   "max_capacity":16,
                   "active":true
                   },
         "instructors":[
                       {
                       "id":8,
                       "name":"Reyes-Franco, Sarah",
                       "bio":"Great TA for 67-272; hopefully can teach chess too.",
                       "email":"sarah@razingrooks.org",
                       "phone":"4122683259",
                       "active":true
                       },{
                       "id":5,
                       "name":"Stapinski, Jordan",
                       "bio":"Great TA for 67-272; hopefully can teach chess too.",
                       "email":"jordan@razingrooks.org",
                       "phone":"4122683259",
                       "active":true
                       }],
           "cost":150.0,
           "start_date":"2018-06-18",
           "end_date":"2018-06-22",
           "time_slot":"pm",
           "max_students":8,
           "is_open":false,
           "open_spots":0,
           "active":true,
           "registered_students_list":[
                                      {"proper_name":"Shakira Koepp"},
                                      {"proper_name":"Ericka Mayer"},
                                      {"proper_name":"Jaycee Walter"},
                                      {"proper_name":"Asia McDermott"},
                                      {"proper_name":"Angeline Ward"},
                                      {"proper_name":"Niko Bailey"},
                                      {"proper_name":"Adell Weissnat"},
                                      {"proper_name":"Neva Walter"}
                                      ],
            "own_registered_students_list":[
                                           {
                                           "proper_name":"Angeline Ward",
                                           "date_of_birth":"2007-05-01",
                                           "rating":326,
                                           "active":true,
                                           "paid":true
                                           }]},
            "student":{
                      "id":27,
                      "proper_name":"Angeline Ward",
                      "family_id":1,
                      "date_of_birth":"2007-05-01",
                      "rating":326,"active":true
                      },
             "payment":"a883c963cbed6699",
             "paid":true}
```
only 27 and 38 work for parent1

### GET /students & GET /students/:id

```
{
"id":27,
"proper_name":"Angeline Ward",
"family_id":1,
"date_of_birth":"2007-05-01",
"rating":326,
"active":true,
"past_camps":[],
"upcoming_camps":[
                 {
                 "id":8,
                 "curriculum":{
                              "id":1,
                              "name":"Principles of Chess",
                              "description":"This camp is designed for beginning students 
                                             who know need to learn opening principles, 
                                             pattern recognition and basic tactics and mates.
                                             Students will be given a set of mate-in-one 
                                             flashcards and are expected to work on these at 
                                             home during the week.",
                              "min_rating":0,
                              "max_rating":500,
                              "active":true
                              },
                  "location":{
                             "id":1,
                             "name":"North Side",
                             "street_1":"801 Union Place",
                             "street_2":null,
                             "city":"Pittsburgh",
                             "state":"PA",
                             "zip":"15212",
                             "max_capacity":16,
                             "active":true
                             },
                   "instructors":[
                                 {
                                 "id":8,
                                 "name":"Reyes-Franco, Sarah",
                                 "bio":"Great TA for 67-272; hopefully can teach chess too.",
                                 "email":"sarah@razingrooks.org",
                                 "phone":"4122683259","active":true
                                 }],
                    "cost":150.0,
                    "start_date":"2018-06-18",
                    "end_date":"2018-06-22",
                    "time_slot":"pm",
                    "max_students":8,
                    "is_open":false,
                    "open_spots":0,
                    "active":true}]
}
```

only access 27 and 38

### GET /families & GET /families/:id

```
{
"id":1,
"family_name":"Ward",
"parent_first_name":"Rosella",
"email":"ward643@example.com",
"phone":"9784675905",
"active":true,
"students":[
           {same format as previous GET /student}
           ]
}
```
